---
title: 从零开始学深度学习——方向导数与梯度
top: false
cover: false
toc: true
mathjax: true
date: 2021-01-14 21:34:57
password:
summary:
tags: [数学, 深度学习]
categories: [深度学习]
---



## 偏导数

### 回顾导数定义

在看偏导数的定义之前，回顾下导数的定义：$y=f(x), x_0\in D, f^\prime(x_0)=\lim_{\Delta x -> 0}\frac{\Delta y}{\Delta x}或者f^\prime(x_0) = \lim_{x->x_0}\frac{f(x) - f(x_0)}{x - x_0}$

然后还有以下性质：

1. $f(x)在x=x_0可导\Rightarrow f(x)在x=x_0连续，反之不成立$
2. $f(x)在x=x_0可导 \Leftrightarrow f(x)在x=x_0可微$



### 偏导数定义

$\zeta=f(x, y), ((x, y)\in D), \forall M_0(x_0, y_0)\in D$

称 $\Delta \zeta_x = f(x_0 + \Delta x, y_0) - f(x_0, y_0)$ 为 $f(x, y)$ 在 $M_0$ 处关于x的**偏增量**

称 $\Delta \zeta_y = f(x_0, y_0 + y_0 + \Delta y) - f(x_0, y_0)$ 为 $f(x, y)$ 在 $M_0$ 处关于y的**偏增量**

称 $\Delta \zeta = f(x_0 + \Delta x, y_0 + \Delta y) - f(x_0, y_0) 或 \Delta \zeta = f(x, y) - f(x_0, y_0)$ 为 $f(x, y)$ 在 $M_0$ 处的**全增量**

 

若 $\lim_{\Delta x-> 0} \frac{\Delta \zeta x}{\Delta x} \exists 或 \lim_{x->x_0} \frac{f(x, y_0)-f(x_0, y_0)}{x-x_0} \exists$  称 $f(x, y)$ 在 $M_0$ 处关于x可偏导，极限值称为 $f(x, y)$ 在 $M_0$ 处关于x的偏导数，记为$f^\prime_{x}(x_0, y_0)$ 或者 $\frac{\partial \zeta}{\partial x}|_{(x_0, y_0)}$

若 $\lim_{\Delta y-> 0} \frac{\Delta \zeta y}{\Delta y} \exists 或 \lim_{y->y_0} \frac{f(x_0, y)-f(x_0, y_0)}{y-y_0} \exists$  称 $f(x, y)$ 在 $M_0$ 处关于y可偏导，极限值称为 $f(x, y)$ 在 $M_0$ 处关于y的偏导数，记为$f^\prime_{y}(x_0, y_0)$ 或者 $\frac{\partial \zeta}{\partial y}|_{(x_0, y_0)}$

若 $\forall (x, y) \in D, f(x, y)$ 在 $(x, y)$ 处对x, y皆可以偏导，称 $f^\prime_x(x, y), f^\prime_y(x, y)$ 为 $f(x, y)$ 对 x, y的偏导函数，简称偏导数。



### 偏导数的计算

例. $\zeta = f(x, y) = x^2y + \ln(x+y^2)，求\frac{\partial \zeta}{\partial x}, \frac{\partial \zeta}{\partial y}$

解：$\frac{\partial \zeta}{\partial x} = 2xy + \frac{1}{x+y^2} $

$\frac{\partial \zeta}{\partial y} = x^2 + \frac{1}{x+y^2} \cdot 2y$



### 偏导数的几何意义

$\zeta=f(x, y), ((x, y)\in D), \forall M_0(x_0, y_0)\in D$

$\frac{\partial \zeta}{\partial x}$的几何意义是：通过该点(x, y)且与ZOX平面平行的平面与 $\zeta$ 的交线上，该点(x, y)的效率，如下图：

<img src="https://img.heshipeng.com/202205081039462.png" alt="image-20220508103959300" style="zoom:50%;" />

之所以取与ZOX平行的平面，是为了保持y方向的增量为0。



$\frac{\partial \zeta}{\partial y}$ 的几何意义类似。

<img src="https://img.heshipeng.com/202205081044383.png" alt="image-20220508104412299" style="zoom:50%;" />



### 高阶偏导数

设函数 $z=f(x, y)$ 在区域 $D$ 内具有偏导函数 $\frac{\partial z}{\partial x} = f_x(x, y), \ \frac{\partial z}{\partial y} = f_y(x, y)$ ，如果关于偏导函数 $f_x(x, y), \ f_y(x, y)$ 的偏导数也存在，那么称他们是函数 $z=f(x, y)$ 的二阶偏导数，四个二阶偏导数如下：

$\frac{\partial}{\partial x}(\frac{\partial z}{\partial x}) = f_{xx}(x, y), \ \frac{\partial}{\partial y}(\frac{\partial z}{\partial y}) = f_{yy}(x, y), \ \frac{\partial}{\partial x}(\frac{\partial z}{\partial y}) = f_{yx}(x, y), \ \frac{\partial}{\partial y}(\frac{\partial z}{\partial x}) = f_{xy}(x, y)$

其中，后边两个偏导数叫做混合偏导数。同样可以得三阶，四阶...以及n阶偏导数，二阶及其以上的偏导数统称为高阶偏导数。



### 高阶偏导数的计算

例. $z=x^3y^2 - 3xy^3 - xy + 1，\ \frac{\partial^2 z}{\partial x^2}? \ \frac{\partial^2 z}{\partial x \partial y}? \ \frac{\partial^2 z}{\partial y \partial x}? \ \frac{\partial^2 z}{\partial y^2}? \ \frac{\partial^3z}{\partial x^3}? $

解：$\frac{\partial z}{\partial x} = 3x^2y^2 - 3y^3 - y, \ \ \frac{\partial z}{\partial y} = 2x^3y - 9xy^2 - x$

​		$\frac{\partial^2 z}{\partial x^2}=6xy^2, \ \ \frac{\partial^2 z}{\partial x \partial y} = 6x^2y - 9y^2 - 1, \ \ \frac{\partial^2 z}{\partial y \partial x} = 6x^2y - 9y^2 - 1$

​		$\frac{\partial^2 z}{\partial y^2} = 2x^3 - 18xy, \ \ \frac{\partial^3z}{\partial x^3} = 6y^2$  



### 高阶偏导数的性质

如果函数 $z=f(x, y)$ 的两个二阶混合偏导数 $z=\frac{\partial^2 z}{\partial x \partial y}$ 及 $\frac{\partial^2 z }{\partial y \partial x}$ 在定义域D内连续，那么该区域内该二阶偏导必然相等。 



## 方向导数

### 定义

 假设有$\eta=f(x, y) ((x, y) \in D)$, 其图像在如下图所示，$\eta$的图像是有一个不规则的圆柱体组成，圆柱体的顶面是一个不规则的曲面。

<img src="https://img.heshipeng.com/202205072043452.jpeg" alt="WechatIMG100" style="zoom:20%; align: middle;" />



在圆柱体的底面任取一点$M_0$，过这个点$M_0$随机作一条射线L，取$M_1(x_0+\Delta x, y_0 + \Delta y) \in L$，如上图所示，则$M_0$到$M_1$的距离$\rho$为$\rho=\sqrt{(\Delta x)^2 + (\Delta y)^2}$。



过这条射线L作一个垂直于圆柱体底面的平面，这个平面与圆柱体的顶面即不规则的曲面相交产生一条弧线，$M_{0}$和$M_{1}$分别对应弧线上的M和$M^\prime$ 。$M_{0}$M和$M_{1}M^\prime$的高度差记为$\Delta \eta$，则$\Delta \eta=f(x_{0}+\Delta x, y_{0}+\Delta y) - f(x_0, y_0)$



我们来看看这个$\Delta \eta$，$\Delta \eta>0$相当于沿着这个曲面由地势低的地方往地势高的地方走，就像图中的沿着曲面从M点走到$M^\prime$这个点。反过来，若$\Delta \eta<0$相当于沿着这个曲面从地势高的地方往地势低的地方走，就好比从$M^\prime$走向M。



我们再看看$\lim_{\rho->0}{\frac{\Delta \eta}{\rho}}$，这个指标反映从地势高往地势低或地势低往地势高方向上移动的效率，如果这个值越大，表示这个地方(曲面上这极小块区域)越陡峭。如果$\lim_{\rho->0}{\frac{\Delta \eta}{\rho}}$存在，称此极限为$\eta=f(x, y)$在$M_{0}$处沿射线L的方向导数。记为$\frac{\partial \eta}{\partial L}|_{M_{0}}$ 

即$\frac{\partial \eta}{\partial L}|_{M_{0}}=\lim_{\rho->0}{\frac{\Delta \eta}{\rho}} 或 \frac{\partial \eta}{\partial L}|_{M_{0}}=\lim_{\rho->0}{\frac{f(x_{0}+\Delta x, y_{0}+\Delta y) - f(x_0, y_0)}{\rho}}$



### 计算公式

##### 2-dims

 $\zeta = f(x, y)，((x, y)\in D)，M_{0}\in D$ 过 $M_{0}$作射线L，设L的方向角为$\alpha 和 \beta$（方向角的定义如下图），则

$\frac{\partial \zeta}{\partial L}|_{M_{0}} = \frac{\partial \zeta}{\partial x} \cos{\alpha} + \frac{\partial \zeta}{\partial y} \cos{\beta}$，其中$\frac{\partial \zeta}{\partial x}$表示$\zeta$对x的偏导，$\frac{\partial \zeta}{\partial y}$表示$\zeta$对y的偏导。



<img src="https://img.heshipeng.com/202205072326064.jpeg?" alt="WechatIMG101" style="zoom:20%; align: middle;" />



##### 3-dims

$u(x, y, z)$ 在 $M_0(x_0, y_0, z_0)$ 可微，过 $M_0$ 作射线L，L的方向角为 $\alpha \beta \gamma，$ 则 $\frac{\partial u}{\partial L}|_{M_0}=\frac{\partial u}{\partial x}|_{M_0}\cos \alpha + \frac{\partial u}{\partial y}|_{M_0}\cos \beta + \frac{\partial u}{\partial z}|_{M_0}\cos \gamma$		

例. 求 $\zeta = xe^{2y}在M_0(1, 0)沿从M_0(1, 0)到M(2, -1)的方向导数$

解：$\frac{\partial \zeta}{\partial x}|_{M_0} = 1, \frac{\partial \zeta}{\partial y}|_{M_0} = 2 $

$\vec{M_0M} = \{1, -1\}, \cos\alpha = \frac{1}{\sqrt{2}}, \cos\beta = \frac{-1}{\sqrt{2}} $

$\frac{\partial \zeta}{\partial L}|M_0 = 1 \cdot \frac{1}{\sqrt{2}} + 2 \cdot (-\frac{1}{\sqrt{2}})$



## 梯度

### 梯度的定义

$u=f(x, y, z)，M_0(x_0, y_0, z_0)\in \Omega $ 过 $M_0$ 作射线L，产生方向角 $\alpha$ $\beta$ $\gamma$ 。则：

$\frac{\partial u}{\partial L}|M_0 = \frac{\partial u}{\partial x}|M_0\cos \alpha + \frac{\partial u}{\partial y}|M_0\cos \beta + \frac{\partial u}{\partial z}|M_0\cos \gamma$  

= $\{\frac{\partial u}{\partial x}, \frac{\partial u}{\partial y}, \frac{\partial u}{\partial z}\} \cdot \{\cos\alpha, \cos\beta, \cos\gamma\}$



向量 $\{\frac{\partial u}{\partial x}, \frac{\partial u}{\partial y}, \frac{\partial u}{\partial z}\}$ 是一个常向量(固定位置，给定了M_0的坐标，这个向量就是一个确定向量)

向量 $\{\cos\alpha, \cos\beta, \cos\gamma\}$ 是一个单位向量(与L同向，**任何一个向量，它的方向余弦构成的向量，就是该向量的单位向量，方向与该向量相同，单位是1**)



<img src="https://img.heshipeng.com/202205081142190.jpeg" alt="WechatIMG102" style="zoom:20%;" />



 $\frac{\partial u}{\partial L}|M_0 = \{\frac{\partial u}{\partial x}, \frac{\partial u}{\partial y}, \frac{\partial u}{\partial z}\}  \vec{e} = \sqrt{(\frac{\partial u}{\partial x})^2 + (\frac{\partial u}{\partial y})^2 + (\frac{\partial u}{\partial z})^2}  \cos\theta$ 

$\sqrt{(\frac{\partial u}{\partial x})^2 + (\frac{\partial u}{\partial y})^2 + (\frac{\partial u}{\partial z})^2}$是一个固定的数，当 $\cos\theta = 1$ 即 $\theta=0$时，$\frac{\partial u}{\partial L}|M_0$取最大值

那么，$u=f(x, y)$ 在 $M_0$ 的梯度即 $grad \ u|M_0$ = $\{\frac{\partial u}{\partial x}, \frac{\partial u}{\partial y}, \frac{\partial u}{\partial z}\}|M_0$ 。一般地，$grad \ u = \{\frac{\partial u}{\partial x}, \frac{\partial u}{\partial y}, \frac{\partial u}{\partial z}\}$

梯度的方向，即函数增长速度最快的方向，或者方向导数取最大值的方向。



### 与方向导数的关系

函数 $\zeta$ 在 $M_0$ 沿着不同的射线可以得到不同的方向导数，梯度则是过 $M_0$ 点所有这些方向导数取最大值时那个射线的方向。

用一个动画展示二者的关系：

<div align="middle">
   <iframe src="//player.bilibili.com/player.html?aid=19844108&bvid=BV1sW411775X&cid=32363257&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="50%"> </iframe>
</div>



### 梯度的计算

设 $u=xyz+z^2+5$， 求 $grad \ u$，并求在点M(0, 1, -1)处的方向导数的最大(小)值。

解：$\because \frac{\partial u}{\partial x} = yz, \frac{\partial u}{\partial y} = xz, \frac{\partial u}{\partial z} = xy + 2z $

$\therefore grad \ u|_{(0, 1, -1)} = (yz, xz, xy+2z)|_{(0, 1, -1)} = (-1, 0, -2) $

从而 $max\{\frac{\partial u}{\partial L}|_M\} = ||grad \ u|| = \sqrt{5}, min\{\frac{\partial u}{\partial L}|_M\} = -||grad \ u|| = -\sqrt{5}$

 

